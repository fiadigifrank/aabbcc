######### é”šç‚¹ start #######
# proxy ç›¸å…³
# pr: &pr {type: select, proxies: [DIRECT, ğŸ‡­ğŸ‡°HK, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ•¹ï¸All, â™»ï¸Auto]}

#è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
p: &p {type: http, interval: 3600, health-check: {enable: true, url: http://cp.cloudflare.com/generate_204, interval: 300}}

use: &use
  type: select
  use:
  - WWCloud
  
######### é”šç‚¹ end #######

# urlé‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤,path(æ–‡ä»¶ä½ç½®)ä¸èƒ½é‡å¤
proxy-providers:
  WWCloud:
    <<: *p
    url: ""
    interval: 3600
    path: ./proxy_providers/provider1.yaml
    health-check:
      enable: true
      interval: 600
      # lazy: true
      url: https://cp.cloudflare.com/generate_204

mixed-port: 7890
unified-delay: false
geodata-mode: true
tcp-concurrent: false
ipv6: true
find-process-mode: strict
global-client-fingerprint: chrome

skip-auth-prefixes: # è®¾ç½®è·³è¿‡éªŒè¯çš„IPæ®µ
  - 127.0.0.1/8
  - ::1/128
lan-allowed-ips: # å…è®¸è¿æ¥çš„ IP åœ°å€æ®µï¼Œä»…ä½œç”¨äº allow-lan ä¸º true, é»˜è®¤å€¼ä¸º0.0.0.0/0å’Œ::/0
  - 0.0.0.0/0
  - ::/0
#lan-disallowed-ips: # ç¦æ­¢è¿æ¥çš„ IP åœ°å€æ®µ, é»‘åå•ä¼˜å…ˆçº§é«˜äºç™½åå•, é»˜è®¤å€¼ä¸ºç©º
#  - 192.168.0.3/32

allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç»‘å®š IP åœ°å€ï¼Œä»…ä½œç”¨äº allow-lan ä¸º trueï¼Œ'*'è¡¨ç¤ºæ‰€æœ‰åœ°å€
mode: rule
log-level: info

#  TCP keep alive interval
keep-alive-interval: 15

external-controller: 0.0.0.0:9093
external-ui-name: xd
#external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
external-ui: /etc/mihomo/ui
#secret: 12345

geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb"

geo-auto-update: true # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 12 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  sniff:
    QUIC:
      ports: [443]
    TLS:
      ports: [443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
  sniffing:
    - tls
    - http

tun:
  enable: true
  tack: system
  dns-hijack:
    - 'any:1053'
  auto-detect-interface: true # è‡ªåŠ¨è¯†åˆ«å‡ºå£ç½‘å¡
  auto-route: true # é…ç½®è·¯ç”±è¡¨
  # inet4-route-address:  # å¯ç”¨ auto_route æ—¶ä½¿ç”¨è‡ªå®šä¹‰è·¯ç”±è€Œä¸æ˜¯é»˜è®¤è·¯ç”±
  #   - 0.0.0.0/1
  #   - 128.0.0.0/1
  # inet6-route-address: # å¯ç”¨ auto_route æ—¶ä½¿ç”¨è‡ªå®šä¹‰è·¯ç”±è€Œä¸æ˜¯é»˜è®¤è·¯ç”±
  #   - "::/1"
  #   - "8000::/1"

#ebpfé…ç½®
# ebpf:
#   auto-redir: # redirect æ¨¡å¼ï¼Œä»…æ”¯æŒ TCP
#     - eth0
#   redirect-to-tun: # UDP+TCP ä½¿ç”¨è¯¥åŠŸèƒ½è¯·å‹¿å¯ç”¨ auto-route
#     - eth0

dns:
  enable: true
  prefer-h3: true
  ipv6: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'
  default-nameserver:
    - 223.5.5.5
    #- 114.114.114.114 # default value
    - tls://223.5.5.5:853 # DNS over TLS
    # - tls://1.12.12.12:853
  nameserver:
    #- 110.40.143.174:5353  # Tecnent
    #- 114.114.114.114 # default value
    #- 8.8.8.8 # default value
    - tls://223.5.5.5:853 # DNS over TLS
    #- tls://1.12.12.12:853
    - https://doh.pub/dns-query # DNS over HTTPS
    - https://dns.alidns.com/dns-query # å¼ºåˆ¶ HTTP/3ï¼Œä¸ perfer-h3 æ— å…³ï¼Œå¼ºåˆ¶å¼€å¯ DoH çš„ HTTP/3 æ”¯æŒï¼Œè‹¥ä¸æ”¯æŒå°†æ— æ³•ä½¿ç”¨
    #- https://mozilla.cloudflare-dns.com/dns-query#DNS&h3=true # æŒ‡å®šç­–ç•¥ç»„å’Œä½¿ç”¨ HTTP/3
    #- quic://dns.adguard.com:784
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  nameserver-policy:
    "rule-set:private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
    # "rule-set:geolocation-!cn":
    #    - 'https://dns.cloudflare.com/dns-query#dns'
    #    - 'https://dns.google/dns-query#dns'

proxies:

proxy-groups:

  - {name: ğŸ›°Global, type: select, proxies: [DIRECT, ğŸ‡­ğŸ‡°HK, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ•¹ï¸All, â™»ï¸Auto, ğŸ¦¹Hy2]}
  - {name: ğŸ“§Telegram, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ¦¹Hy2]}
  - {name: ğŸStreaming, type: select, proxies: [ğŸ›°Global, DIRECT,ğŸ‡­ğŸ‡°HK, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ¦¹Hy2]}
  - {name: ğŸ’¾Dropbox, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¸ğŸ‡¬SG, ğŸ¦¹Hy2]}
  - {name: ğŸ€Naver, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¸ğŸ‡¬SG, ğŸ¦¹Hy2]}
  - {name: ğŸ“½ï¸Netflix, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ¦¹Hy2]}
  - {name: ğŸ¤–OpenAI, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ¦¹Hy2]}
  - {name: ğŸ’ Microsoft, type: fallback, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ¦¹Hy2]}
  - {name: ğŸ¦Twitter, type: fallback, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ¦¹Hy2]}
  - {name: ğŸApple, type: select, proxies: [DIRECT, ğŸ›°Global, ğŸ‡¹ğŸ‡¼TW, ğŸ‡ºğŸ‡²US, ğŸ¦¹Hy2]}
  - {name: ğŸ§Spotify, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ¦¹Hy2]}
  - {name: ğŸ‡¨ğŸ‡³Domestic, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡­ğŸ‡°HK, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ•¹ï¸All, â™»ï¸Auto]}
  - {name: ğŸŸList, type: select, proxies: [ğŸ›°Global, DIRECT, ğŸ‡­ğŸ‡°HK, ğŸ‡¹ğŸ‡¼TW, ğŸ‡¯ğŸ‡µJP, ğŸ‡°ğŸ‡·KR, ğŸ‡¸ğŸ‡¬SG, ğŸ‡ºğŸ‡²US, ğŸ±Other, ğŸ•¹ï¸All, â™»ï¸Auto, ğŸ¦¹Hy2]}

#åˆ†éš”ï¼Œä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - {name: ğŸ¦¹Hy2, type: select , include-all-providers: true, filter: "(?i)Hy|Hy2|Hysteria|Hysteria2|ğŸ¦¹"}
  - {name: ğŸ‡­ğŸ‡°HK, <<: *use,filter: "(?i)æ¸¯|hk|HK|hongkong|hong kong|ND3", type: url-test}
  - {name: ğŸ‡¹ğŸ‡¼TW, type: select , include-all-providers: true,  filter: "(?i)å°|tw|TW|taiwan|ğŸ‡¹ğŸ‡¼"}
  - {name: ğŸ‡¯ğŸ‡µJP, type: select , include-all-providers: true, filter: "(?i)æ—¥æœ¬|jp|JP|japan|ND7"}
  - {name: ğŸ‡°ğŸ‡·KR, type: select , include-all-providers: true, filter: "(?i)KR|Korea|KOR|ğŸ‡°ğŸ‡·|é¦–å°”|éŸ©|éŸ“|æ˜¥å·"}
  - {name: ğŸ‡ºğŸ‡²US, type: select , include-all-providers: true, filter: "(?i)ç¾|us|unitedstates|united states|ND4"}
  - {name: ğŸ‡¸ğŸ‡¬SG, type: select , include-all-providers: true, filter: "(?i)æ–°|sg|singapore|ND5"}
  - {name: ğŸ±Other, type: select , include-all-providers: true, filter: "(?i)ğŸ‡©ğŸ‡ª|ğŸ‡¬ğŸ‡§|ğŸ‡¹ğŸ‡·|ğŸ‡µğŸ‡­|ğŸ‡¦ğŸ‡º|ğŸ‡«ğŸ‡·|ğŸ‡®ğŸ‡³|ğŸ‡¨ğŸ‡¦|ğŸ‡·ğŸ‡º|ğŸ‡§ğŸ‡·|ğŸ‡²ğŸ‡¾|ğŸ‡³ğŸ‡±|ğŸ‡¦ğŸ‡ª|ğŸ‡¿ğŸ‡¦"}
  - {name: ğŸ•¹ï¸All, <<: *use}
  - {name: â™»ï¸Auto, <<: *use, tolerance: 2, type: url-test}

rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: yaml}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: yaml}
rule-providers:
  private:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.yaml"
  cn_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.yaml"
  spotify_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.yaml"
  opanai_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/openai.yaml"
  telegram_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.yaml"
  github_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.yaml"
  dropbox_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/dropbox.yaml"  
  youtube_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.yaml"
  ï¸Netflix_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.yaml"
  google_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.yaml"
  naver_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/naver.yaml"
  twitter:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/twitter.yaml" 
  Notion:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/notion.yaml"
  Microsoft:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.yaml"
  apple: # Apple åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/apple.yaml"
  applications:
    <<: *domain
    url: "https://raw.githubusercontent.com/fiadigifrank/aabbcc/main/meta-ruleset/applications.yaml"
  # geolocation-!cn:
  #   <<: *domain
  #   url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.yaml"

  cn_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.yaml"
  google_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.yaml"
  netflix_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.yaml"
  twitter_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/twitter.yaml"
  telegram_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.yaml"

rules:
# æŠ— DNS æ±¡æŸ“
  - GEOIP,lan,DIRECT,no-resolve
  - DOMAIN-KEYWORD,facebook,ğŸ›°Global
  - DOMAIN-SUFFIX,fb.me,ğŸ›°Global
  - DOMAIN-SUFFIX,fbcdn.net,ğŸ›°Global
  - DOMAIN-KEYWORD,instagram,ğŸ›°Global
  - RULE-SET,google_domain,ğŸ›°Global
  - RULE-SET,opanai_domain,ğŸ¤–OpenAI
  - RULE-SET,dropbox_domain,ğŸ’¾Dropbox
  - RULE-SET,twitter,ğŸ¦Twitter
  - RULE-SET,spotify_domain,ğŸ§Spotify
  - RULE-SET,naver_domain,ğŸ€Naver
  - RULE-SET,telegram_domain,ğŸ“§Telegram
  - RULE-SET,youtube_domain,ğŸStreaming
  - RULE-SET,ï¸Netflix_domain,ğŸ“½ï¸Netflix
  - RULE-SET,apple,ğŸApple
  - RULE-SET,Notion,ğŸ›°Global
  - RULE-SET,github_domain,ğŸ›°Global
  - RULE-SET,Microsoft,ğŸ’ Microsoft
  - RULE-SET,applications,DIRECT
  #- RULE-SET,geolocation-!cn,ğŸŸList
  

  - RULE-SET,google_ip,ğŸ›°Global
  - RULE-SET,telegram_ip,ğŸ“§Telegram
  - RULE-SET,netflix_ip,ğŸ“½ï¸Netflix
  - RULE-SET,twitter_ip,ğŸ¦Twitter
  - RULE-SET,cn_domain,DIRECT
  - RULE-SET,cn_ip,DIRECT
  - MATCH,ğŸŸList