#load_module modules/ngx_stream_module.so;
events {
    use epoll;
    worker_connections 512;
    multi_accept on;
}

http {
  upstream A1 {
       server 211.23.26.80:3443;  #A1-OJ2F
       server 125.227.6.56:3443;  #A1-TaipeiSmile
       check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
  }
  upstream B1 {
       server 125.227.237.20:3443;  #B1-fiadigital
       server 60.248.90.224:3443;  #B1-world 01 (HIS)
       server 60.248.90.223:3443;  #B1-world 02 (own)
       server 203.69.57.59:3443; #B1-JingRe
       server 118.163.20.30:3443; #B1-JaMei
       server 60.250.75.149:3443; #B1-Union
       server 210.68.205.47:3443; #B1-Berry
       check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
  }
  upstream C1 {
       server 60.251.220.201:3443;  #C1-Washington
       server 61.220.227.98:3443;  #C1-Omni
       check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
  }
  upstream D1 {
       server 61.220.247.242:3443;  #D1-imperial
       server 60.251.205.98:3443;  #D1-OJack
       check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
  }
     server {
        # TWNode A1
        listen            58001 ssl;
        server_name bgplbtw.nbnodeyyds.xyz;
        ssl_protocols    TLSv1.2 TLSv1.3;      # 设置使用的SSL协议版本

        ssl_certificate /root/cert.crt; # 证书地址
        ssl_certificate_key /root/private.key; # 秘钥地址
        ssl_session_cache   shared:SSL:10m;             # SSL TCP会话缓存设置共享内存区域名为
                                                        # SSL，区域大小为10MB
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305;
        ssl_session_timeout 10m;                        # SSL TCP会话缓存超时时间为10分钟
#        proxy_protocol    on; # 开启proxy_protocol获取真实ip
        location / {
           proxy_pass       http://A1;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection "upgrade";
           proxy_set_header Host $http_host;
        }
    }
    server {
        # TWNode B1
        listen            58011 ssl;      
        server_name bgplbtw.nbnodeyyds.xyz;
        ssl_protocols    TLSv1.2 TLSv1.3;      # 设置使用的SSL协议版本

        ssl_certificate /root/cert.crt; # 证书地址
        ssl_certificate_key /root/private.key; # 秘钥地址
        ssl_session_cache   shared:SSL:10m;             # SSL TCP会话缓存设置共享内存区域名为
                                                        # SSL，区域大小为10MB
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305;
        ssl_session_timeout 10m;                        # SSL TCP会话缓存超时时间为10分钟
#        proxy_protocol    on; # 开启proxy_protocol获取真实ip
        location / {
           proxy_pass       http://B1;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection "upgrade";
           proxy_set_header Host $http_host;
        }
    }
    server {
        # TWNode C1
        listen            58021 ssl;
        server_name bgplbtw.nbnodeyyds.xyz;
        ssl_protocols     TLSv1.2 TLSv1.3;      # 设置使用的SSL协议版本

        ssl_certificate /root/cert.crt; # 证书地址
        ssl_certificate_key /root/private.key; # 秘钥地址
        ssl_session_cache   shared:SSL:10m;             # SSL TCP会话缓存设置共享内存区域名为
                                                        # SSL，区域大小为10MB
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305;
        ssl_session_timeout 10m;                        # SSL TCP会话缓存超时时间为10分钟
#        proxy_protocol    on; # 开启proxy_protocol获取真实ip
        location / {
           proxy_pass       http://C1;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection "upgrade";
           proxy_set_header Host $http_host;
        }
    }
    server {
        # TWNode D1
        listen            58031 ssl;
        server_name bgplbtw.nbnodeyyds.xyz;
        ssl_protocols   TLSv1.2 TLSv1.3;      # 设置使用的SSL协议版本

        ssl_certificate /root/cert.crt; # 证书地址
        ssl_certificate_key /root/private.key; # 秘钥地址
        ssl_session_cache   shared:SSL:10m;             # SSL TCP会话缓存设置共享内存区域名为
                                                        # SSL，区域大小为10MB
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305;
        ssl_session_timeout 10m;                        # SSL TCP会话缓存超时时间为10分钟
#        proxy_protocol    on; # 开启proxy_protocol获取真实ip
        location / {
           proxy_pass       http://D1;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection "upgrade";
           proxy_set_header Host $http_host;
        }
    }    
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        types_hash_max_size 2048;
        keepalive_timeout 65;
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
        ssl_prefer_server_ciphers on;
        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;
        gzip on;
        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}